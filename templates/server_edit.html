{% extends 'layouts/server_base.html' %}
{% load static %}

{% block content %}

      <div class="container text-white">

        <div class="bg-customdark m-5 rounded p-5">

          <h1><i class="fa fa-server" aria-hidden="true"></i> Edit HelloWorld Community</h1>

          <form action="/api/editServer" method="POST">

          <div class="form-group bg-dark rounded p-2 m-3">
            <h3>Short description of your server <a class="text-decoration-none text-danger">*</a></h3>
            <input type="text" class="form-control bg-customdark text-white" value="OldValueHere" name="shortDesc" id="shortDesc" aria-describedby="helpId" placeholder="300 characters max">
          </div>

          <div class="form-group bg-dark rounded p-2 m-3">
            <h3>Long description of your server <a class="text-decoration-none text-danger">*</a></h3>
            <p class="text-danger">Markdown, HTML and CSS are supported.</p>
            <div onkeyup="monacoToField();" id="longDescEditor" class="editorBackdrop"></div>
            <textarea id="longDesc" name="longDesc" hidden style="display: none;"></textarea>
            <p><span id="BotLongDescCounter"></span></p>
          </div>



          <div class="form-group bg-dark rounded p-2 m-3">
            <div class="row">
            <button type="submit" class="btn btn-success col m-5"><i class="fas fa-edit"></i> Edit</button>
          </div>
          </div>
      </form>
    </div>

</div>
{% endblock content %}

{% block script %}
<script>


  require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min/vs' } });

require(['vs/editor/editor.main'], function () {
 window.editor = monaco.editor.create(document.getElementById("longDescEditor"),{
    language:"markdown",
    automaticLayout: true
    });


    monaco.editor.setTheme("vs-dark");

  });

  async function monacoToField(){
    document.getElementById("longDesc").value = window.editor.getValue();
    updateLongDescLength(window.editor.getValue())
    console.log("[autosave] autosaved long desc in internal textaera")
    }

  function doSubmit() {
  monacoToField();
  }

  async function updateShortDescLength(txt) {
      let lng = txt.length;
      if(lng > 130 && lng !== 150) document.getElementById("BotShortDescCounter").style.color = "orange"
      else if(lng == 150) document.getElementById("BotShortDescCounter").style.color = "red"
      else document.getElementById("BotShortDescCounter").style.color = "white"
      document.getElementById("BotShortDescCounter").innerHTML = lng + '/150';
  }

  async function updateLongDescLength(txt) {
  let lng = txt.length;
  if(lng > 10000 && lng < 15000) document.getElementById("BotLongDescCounter").style.color = "orange"
  else if(lng >= 15000) document.getElementById("BotLongDescCounter").style.color = "red"
  else document.getElementById("BotLongDescCounter").style.color = "white"
  document.getElementById("BotLongDescCounter").innerHTML = lng + '/15000';


}


</script>

{% endblock script %}